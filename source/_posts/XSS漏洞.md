---
title: XSS漏洞
date: 2025-04-18 20:55:20
tags: 
  - XSS
  - 绕过方式
  - 输入检测
categories:
  - Web渗透
keywords:
  - XSS
  - 信息转换
description:
  - XSS漏洞有多种类型，大致分为DOM、反射型、储存型，在一定情境下，他们的影响巨大。
comments: true
cover: https://cdn.jsdelivr.net/gh/Miss3504186601/blog-assets@latest/pictures/7361554c167bba4f5ebc6ad2cc3a35b.jpg
---

# XSS漏洞

## 一、前言

跨站脚本（Cross-Site-Scripting，XSS/CSS）是一种在Web应用程序中的计算机安全漏洞，主要由于Web应用程序对用户输入过滤不足。

攻击者将恶意脚本（HTML、Javascript）注入网页，其他用户浏览网页时执行恶意脚本。常见危害是信息泄露：cookie、passwd。另外会有其他各式
影响，取决于信息内容与场景。部分举例：
1. 网络钓鱼，包括盗取各类用户账号；
2. 窃取用户cookies资料，从而获取用户隐私信息，或利用用户身份进一步对网站执行操作；
3. 劫持用户（浏览器）会话，从而执行任意操作，例如进行非法转账、强制发表日志、发送电子邮件
等；
4. 强制弹出广告页面、刷流量等；
5. 网页挂马；
6. 进行恶意操作，例如任意篡改页面信息、删除文章等；
7. 进行大量的客户端攻击，如DDoS攻击；
8. 结合其他漏洞，如CSRF漏洞，实施进一步作恶；
9. 传播跨站脚本蠕虫等。

## 二、XSS漏洞介绍

### 1. DOM型

- 简介

DOM是文档对象模型（Document Object Model）的缩写，它是一种用于表示和操作HTML、XML等文
档的编程接口。DOM将文档视为一个由节点组成的层次结构，其中每个节点代表文档中的一个元素、属性、文本或注
释。节点之间存在父子关系、兄弟关系等，这构成了文档的层次结构。

开发人员可以使用DOM提供的API来访问和操作文档中的节点，例如查找节点、添加节点、删除节点、
修改节点属性、样式等。通过DOM，开发人员可以创建交互式的Web应用程序、动态地更新页面内容，
从而增强用户体验。

DOM型XSS是非持久型XSS，且不与后台服务器产生数据交互，而是通过javascript修改网页的DOM来执
行恶意脚本进行攻击。注意，DOM型XSS与反射型和存储型最大的区别在于，DOM型XSS不经过服务
端，全部的攻击过程都在客户端完成。

### 2. 反射型

- 简介
反射型 XSS 攻击是最常见的一种 XSS 攻击类型，又称为做非持久型XSS。指的是服务端应用在收到客户
端的请求后，未对请求中的参数做合法性校验或安全过滤，直接将参数用于构造 HTML页面并返回给浏
览器显示，如果参数中包含恶意脚本，就会以HTML代码的形式被返回给浏览器执行。因此，这一类攻
击被称为“反射型XSS”(Reflected XSS) 攻击。

通过给别人发送带有恶意脚本代码参数的URL，当URL地址被打开时，特有的恶意代码参数被HTML解
析、执行。它的特点是非持久化，必须用户点击带有特定参数的链接才能引起

- 攻击方式

构造URL--》用户点击，浏览器未进行安全过滤或检查--》恶意脚本执行，信息泄露

- 探测方式

    1. 寻找输入框或者其他可交互的地方
    2. 输入信息，并检查相应页面是否含有输入的信息（确认输入信息是否被检查过滤）
    3. 不断尝试分析，直到弹窗出现。（真实环境不要直接`<script>`,先进行片段尝试，`script`，`<`,`>`）

### 3. 储存型

- 简介

存储型XSS又称为持久型XSS，是指：攻击者将XSS代码发送给了后端，而后端没有对这些代码做处理直
接存储在数据库中。当用户访问网站时，又直接从数据库调用出来传给前端，前端解析XSS代码就造成
了XSS攻击。

常见于留言板、文章、评论中

- 攻击步骤

  1. 攻击者提交恶意脚本到数据库
  2. 受害者访问网页，服务器返回恶意脚本并在前端执行

## 三、攻击方式

- 基本变形
  - 大小写变换：
  - 空白字符。应用中的安全过滤函数只是简单地检测输入参数中有没有特征，则可以通过填充空白字符(空格、制
表符、换行) 来绕过检测:
  - 双写绕过。有的安全过滤函数只是将“”等字符串删掉，如果提交如下 Payload，经过“安全过滤函数”处理一次后即可
还原成有效的Payload:`<scrip*script*t>
- js事件处理程序
  - onerror
  - onload
  - onmouseover
  - onmousedown
  - onblur
  - onfocus
- javascript 伪协议。浏览器可以接受内联的 JavaScript 代码作为 URL，所以在需要指定 URL 的标签属性中，可以尝试构造
一个 JavaScript 伪协议的 URL 来执行 JavaScript 代码。`<img src=javascript:alert(1)>`
- 编码绕过
  - html编码。通常一个网页中可解析的总共有三种编码，每种编码都能用来代替表示字符，按解析顺序依次是“html实
体编码”“URLcode码”“Unicode码”，在执行过程中会在HTML环境下先解析“html实体编码”和“URLcode
码”，然后查看有无js环境并解析其中的Unicode编码，
  - 实体编码。HTML 实体是一段以’&#‘开头、加上ASCII码居中、以分号‘;’结尾的文本，如：“ ；”，实体常常用于显示
保留字符，和不可见的字符，作为HTML环境第一次解析的编码，这些字符可能还会进一步被解析为URLcode、js 代码。

## 四、防御方式

- 设置httponly。Cookie 的 HtpOnly 属性，是让客户端 JavaScript 代码不能读取 Cookie.但是在** HTTP 请求中
还是会正常发送 Cookie，这就保证了存在 XSS 漏洞时也不会泄露会话Cookie。
- 输入过滤。
- 输出转义。
  - 对于常见的 Web 安全漏洞，如 XSS、SQL 注入等，攻击者都会构造一些特殊字符，这些特殊字符可能是正常用户不会用到的，所以有必要检查和过滤输入的参数(输入过滤)。
  输入过滤在很多时候也被用于检查格式。
  - 输入过滤的逻辑必须放在服务端代码中实现。如果只是在客户端通过 JavaScript 代码对输入进行检查,是
很容易被攻击者绕过的。
- 输出转义。既然参数在输入时做全局过滤和转义存在各种问题，那么就应该在输出变量时根据不同的场景有针对性
地编码或转义。最常见的变量输出场景是该变量用于构造 HTML 页面，这里分两种情况:一种是变量作为HTML 标签的属
性值，另一种是变量作为标签的内容。
  - 变量作为属性值。
    - 双引号必须转义，否则变量里含有双引号会将属性提前闭合。
    - 单引号也需要转义，因为属性值用单引号包围也是合法的。
    - 
  - 变量作为标签内容。当变量作为标签内容时，我们必须让变量以文本形式显示，而不能引入其他 HTML 标签。
    - “<”和“>”字符需要转义，这样就不会产生新标签了。
    - 以“&”字符也需要转义。是如果变量的原始内容就包含了“&qu ot;”这 6个字符，那么输出到HTML 页面上时，这6个字符将显示成双引号，内容发生了变化，这不是我们想看到的结果
  - 将变量输出到标签的代码中。
    - 双引号和单引号需要通过反斜杠“\ ”来转义。单引号没有提前闭合，攻击就失效了。
      - 转义的反斜杠本身也是需要转义的。`<script>var name = ‘$v';</script>`中`$v`=`\’;alert(1);//`,提前结束了。
```javascript
<script>
var name = ‘\\';alert(1);//’;
</script>
```

## 靶场练习

- VMWA
- PiKaChu
- XSS