---
title: 密码学原理
date: 2025-06-03 22:15:43
tags:
  - 密码学
categories:
  - 专业课
keywords:
  - 密码学
description: 作为期末复习资料
cover: https://cdn.jsdelivr.net/gh/Miss3504186601/blog-assets@latest/pictures/305092625a0fca78655e50f012c517c3.jpg
---
# 引言

## 密码学的发展

> 1949年`C.E Shannon`发表`保密系统的通信协议`，为密码学奠定坚实的理论基础
> 1976年`W.Diffe`和`M.E.Hellman`发表`密码学中的新方向`，提出一种崭新的密码设计思想，导致了密码学上的一场革命。

## 保密系统

> 一个保密系统主要由：`明文信源`、`信道`、`加密器`、`解密器`以及`密钥源`五个基本部分组成。

## 密码体制

> 一个密码体制通常由：`明文空间`、`密文空间`、`密钥空间`、`加密算法以及`解密算法`五个基本部分组成。

### 分类

1. 加密密钥与解密密钥是否相等

   * 对称密码。DES、AES
   * 非对称密码。RSA、EIGIMAL
2. 密钥的使用方式

   * 序列密码：明文、密文、密钥以位（字符）为单位加解密，核心密码的主流，典型密码：RC4、ZUC
   * 分组密码：明文、密文、密钥以分组为单位加解密，商用密码的主流，典型密码：DES、AES、SMS4
3. 密码算法是否变化

   * 演化密码：借鉴生物进化，将密码学与演化计算结合，密码算法不断演化变化，越变越好。实现密码设计与密码分析自动化的一种方法，密码系统智能化的一种成功实践
   * 固定算法密码：密码工作过程中算法固定不变，密钥可变。迄今为止的绝大多数密码都是固定算法密码，典型密码:DES, AES, SMS4, RC4, RSA,EIGAMAL, ECC
4. 是否基于数学划分

   1. 基于数学：上述所有密码
   2. 基于非数学：
      1. 量子密码：基于量子的保密物理属性，利用量子力学产生真随机数作密钥。利用量子通信的保密性传输密钥，利用模2加进行加密，一次一密
      2. DNA密码：基于生物学中基因序列的破解困难性，缺少理论，尚未成熟

### 密码设计方法

1. 公开设计原则

> 密码的安全应仅依赖于对「密钥的保密」，不依赖于对算法的保密。(Kerckhoff原则)

1. 扩散和混淆

* 扩散(diffusion):将明文和密钥的每一位的影响散布到尽量多的密文位中，

理想情况下达到完备性。

* 混淆(confusion):使明文、密钥和密文之间的关系复杂化。

1. 迭代与乘积

* 迭代：多次应用一个相同或相似的操作，设计一个轮函数，然后迭代。
* 乘积：将几种密码联合应用。

## 密码分析

密码编制学 + 密码分析学 = 密码学（Cryptology）

> 密码分析就是对密码体制的攻击。

### 攻击密码体制的方法

1. 穷举攻击
2. 数学分析

   * 统计分析攻击：密码分析者通过分析密文和明文的统计规律来破译密码。（早期）
   * 解密变换攻击：通过数学求解的方法来设法找到相应的解密变换。 

>     1. 唯密文攻击：密码分析者仅根据截获的密文来破译密码。
>     2. 已知明文攻击：密码分析者知道一些明文和相应的密文，即明-密文对。
>     3. 选择明文攻击：密码分析者可以选择明文并获得相应的密文。
>     4. 选择密文攻击：密码分析者可以选择一些密文并得到相应的明文。
>     5. 自适应选择明文攻击
>     6. 选择密钥攻击
3. 基于非数学的密码分析

   - 指密码分析者获取并分析密码芯片的物理参数（如：功率、电流、声音、执行时间等）来破译密码。
   - 攻击原理：密码芯片在执行不同的指令、处理不同数据时所消耗的功率、电流、时间等不同。
   - 两种攻击目的：获取密钥、获取密码算法

## 密码体制的安全性

- 计算安全性：使用最好的算法来破译密码体制至少需要 n 次操作，n 是一个非常大的数。
- 可证明安全性：一个密码体制的安全性可以归结为某一个数学问题，数学问题目前是难解的。
- 无条件安全性：密码分析者即使具有无限的计算能力, 也无法破译该密码体制。

---

## 练习

1. 1976年，W. Diffie 和M. E. Hellman, 发表了「密码学中的新方向」，提出了公钥密码设计思想, 导致了密码学上的一场革命。
2. 密码学又分为：「密码编制学」和 「密码分析学」
3. 一个保密系统一般由 「明文信源」、「信道」、「加密器」、「解密器」、「密钥源」 组成。
4. 从加密密钥与解密密钥是否相同的角度，密码体制可分为： 「对称密码」 和「非对称密码」

![练习](https://cdn.jsdelivr.net/gh/Miss3504186601/blog-assets@latest/pictures/20250607143355319.png)

# 古典密码

1. 在中国古代的使用

中国古代有着丰富的军事实践和发达的军事理论,其中不乏巧妙、规范和系统的保密通信和身份认证方法。

中国古代兵书《六韬》（姜子牙）中的阴符和阴书:
- 阴符：国君与主将之间用阴符秘密联络。阴符共有八种，不同长度代表不同含义；
- 阴书：如果有军机大事需要联络,应该用书信而不用符。书信都要拆分成三部分,并分派三人发出,每人拿一部分。只有这三部分合在一起才能读懂信的内容。（机密信）

中国宋代兵书《武经总要》 中的“符契”、“信牌”和“字验”三节,专门讲述军队中秘密通信和身份验证的方法。
- “符” 是皇帝派人向军队调兵的凭证，“契”是主将派人向镇守各方的下属调兵的凭证
- “信牌”是两军阵前交战时,派人传送紧急命令的信物和文件。
- “字验”则是秘密传送军情的一套方法。先约定40种不同的军情,然后用一首含有40个不同字的诗,令其中每一个字对应一种军情。传送军情时,写一封普通的书信或文件,在其中的关键字旁加印记。

2. 其他国家

- 古埃及:象形文字
- 古印度:《经济论》描述了当时密探充斥全国时，特务机关的官员用密写的方式给密探下达任务
- 古希腊:大约在公元前700年,古希腊军队用一种叫做Scytale的圆木棍来进行保密通信，称之为斯巴达棒。 斯巴达棒的加密原理属于密码学中的“换位法”(Transition)加密, 因为它通过改变文本中字母的阅读顺序来达到加密的目的。

## 古典密码中的基本加密运算

> 前置知识:模q运算\群\环\乘法群\辗转相除法\


### 单表密码体制

> 对于一个密码体制, 明文字母对应的密文字母在密文中保持不变

- 加法密码
- 乘法密码
- 仿射密码:加法密码和乘法密码是仿射密码的特例
- 置换密码:仿射密码是置换密码的特例

### 多表密码体制

> 对于一个密码体制, 不同位置的同一明文字母在密文中对应的密文字母不同

- 简单加法密码
- 简单乘法密码
- 简单仿射密码
- 简单置换密码
- 换位密码
> 把明文中的字母重新排列，字母本身不变，但其位置改变。密钥量为$q!$
> 把明文按照某一顺序排成一个矩阵，然后按另一顺序选出矩阵中的字母以形成密文，最后截成固定长度的字母组作为密文。

### 小结

| 运算                  | 单表密钥量 | 多表密钥量     |
| --------------------- | ---------- | -------------- |
| 加法（移位密码）      | $q$        | $q^n$          |
| 乘法（采样密码）      | $\phi(q)$  | $\phi(q)^n$    |
| 仿射 （加法结合乘法） | $q\phi(q)$ | $q^n\phi(q)^n$ |
| 置换（替换密码）      | $q!$       | ${q!}^n$       |


## 几种典型的古典密码体制

### 几种典型的单表古典密码体制

- Caesar 体制:Caesar 体制是一种典型的加法密码, 其密钥 k = 3。
- 标准字头密码体制:这是一种置换密码。

### 几种典型的多表古典密码体制

- Playfair体制
  - 26字母构造$5x5$矩阵,i、j同一个。插入字母，够成为偶数
  - 明文两两分组
  - 三种情况对应密文，右边、下边、右边
- Vigenère加密
  - $c_i\ =\ m_i\ +\ k_i\ mod\ 26$
  -
- Vernam加密
  - $c_i\ =\ m_i\ xor\ k_i$
- Hill加密
  - 矩阵乘法
  - 隐藏频率信息

## 古典密码的统计分析

### 单表

- 统计密文中各个字母出现的次数和频率
- 从出现频率最高的几个单字母及双字母、三字母组合入手，逐步推测各密文对应的明文。

### 多表
  - 确定密钥长度
    - Kasiski测试
    - 重合指数法
  - 破译

---

# Shannon理论

## 密码体制的数学模型

## 熵及其性质

### 信息熵的定义

所有概率分布所构成的熵，以等概率时为最大。

**熵**
$H(X)=-\sum_{i=1}^{n}Pr(x_i)\log_2Pr(x_i)$

**联合熵**
$H(X,Y)=-\sum_{i=1}^{n}\sum_{j=1}^{m}Pr(x_i,y_j)\log_2Pr(x_i,y_j)$

**条件熵**
$H(X|Y)=-\sum_{i=1}^{n}\sum_{j=1}^{m}Pr(y_j)Pr(x_i|y_j)\log_2Pr(x_i|y_j)$

### 信息熵的性质

$0\ \leqslant H(X)\leqslant \log_2n$

$H(X,Y)\leqslant H(X)+H(Y)$

$H(X,Y)=H(Y)+H(X|Y)=H(Y)+H(X,Y)-H(Y,X)$

$H(X|Y)\leqslant H(X)$

## 伪密钥与唯一解距离

### 伪密钥

一般而言，密码分析者会得到许多可能的密钥，但其中只有一个是正确的密钥，其他可能的密钥称为**伪密钥**。

### 唯一解距离

密码分析者在有足够的计算时间的情况下，能够唯一地计算出正确密钥所需的密文的平均长度.

- 当密文长度n比较小时，伪密钥期望的数目并不准确。
- 明文语言的冗余度越大，唯一解距离就越小，密码分析者在唯密文攻击的情况下就越容易求得正确的密钥.
- 为提高密码体制的安全性，应尽量减少明文语言的冗余度.一种方法是在对明文进行加密之前，先采用 Huffman 编码对明文进行压缩

## 完善保密性

$Pr(x|y)\ =\ Pr(x)$

一个密码体制具有完善的保密性当且仅当明文与密文是相互独立的,在唯密文攻击的情况下,从密文得不到关于明文的任何信息。

**完善保密性的充分必要条件**
- 明文空间、密文空间和密钥空间中**点数相等**
- 每个明文在明文空间中出现的概率都不是 0
- 每个密文在密文空间中出现的概率都不是 0

![](https://cdn.jsdelivr.net/gh/Miss3504186601/blog-assets@latest/pictures/20250607152426437.png)

## 乘积密码体制

- 乘积密码体制
- 可交换的密码体制:$S_1S_2 = S_2S_1$
- 迭代密码体制

## 练习

1. 为求得密码唯一解，所需要的最少密文数量称密码的{唯一解距离} 。
2. 明文语言的冗余度越{小}，密码保密水平越高，冗余度越{大}，密码保密水平越低。
3. 可交换的密码体制满足{S1S2=S2S1}。
4. 什么是唯密文攻击，什么是已知明文攻击？

![](https://cdn.jsdelivr.net/gh/Miss3504186601/blog-assets@latest/pictures/20250607153436154.png)

# 分组密码

分组密码又称为对称密码

## 基本原理

**一个好的分组密码应集安全、效率、可实现性及灵活性于一身。**

**现代分组密码的设计基础：扩散、混淆**
- 扩散：明文影响密文的分布
- 混淆：明文与密文的关系

## 结构

- Feistel网络:平衡Feistel网络\非平衡Feistel网络

DES使用

- SP网络

AES使用

## DES

- 分组密码:明文\密文\密钥分组均为64位,密钥有效位56位
- 面向二进制数据
- 加密解密使用统一算法
- Feistel网络

### 加密过程

- 明文
- 初始置换IP
- 16轮迭代
  - 子密钥生成
    - **选择置换PC-1**: 密钥k中有8位是*奇偶校验位*,分别位于第8,16,24,32,40,48,56,64 位,用于检査密钥在产生和分配以及存储过程中可能发生的错误.
    - **循环左移**
    - **选择置换PC-2**: 从$C_i$和$D_i$ (56位）中选择出一个48位的子密钥$K_i$
  - 函数F--DES保密的核心
    - 位选择函数E
    - 与密钥异或
    - S盒.S盒是DES中唯一的*非线性变换*，是DES安全的关键;在保密性方面，起*混淆*作用;共有8个S盒，并行作用;每个S盒有6个输入，4个输出，是*非线性压缩变换*。
    - 置换函数P
- 逆初始置换IP^-1
- 密文

### 安全性

**初始置换与逆初始置换**
- 目的：把数据彻底打乱重排
- 与密钥无关，对数据加密作用不大。

**S盒是DES的关键**
- 在DES中，除S盒是*非线性变换*之外，其他变换均为线性变换；
- 任意改变S盒输入中的几位，输出至少有两位发生变化；在 DES 中使用了 16 次迭代，即使改变明文或密钥中的1位，密文中都会大约有 32位发生变化；
- 至今还没有发现S盒的致命缺陷。

### 多重DES

为了提高 DES 的安全性能、充分利用有关 DES 的已有软件和硬件资源，可以使用多重 DES；
- 多重 DES 就是使用**多个密钥**利用 DES 对明文进行多次加密；
- 使用多重 DES 可以**增加密钥量**，从而大大提高抵抗对密钥的穷举搜索攻击的能力。

**双重DES的有效密钥长度为56×2 = 112**
尽管双重DES 密钥量大大增加, 但中途相遇攻击(meet-in-the-middle attack)对它构成了威胁，因此, 在实际应用中一般不采用双重DES。

## AES

### 概述

> 1997年美国政府向社会公开征集高级加密标准AES。
> 2001年11月26日NIST接受其作为高级加密标准AES。

**AES的设计要求**
- 安全性：可以抵抗所有已知的攻击；
- 实用性：适应各种应用环境，加解密速度快；
- 扩展性：分组长度和密钥长度可扩展，可以适应社会对保密性不断提高的需求。

**特点**
- 面向二进制数据,可以加密任何形式的计算机数据
- 分组密码,明文与密文长度128位,密钥128/192/256位
- 整体结构为SP结构,基本轮函数迭代,迭代轮数可变10轮，12轮，14轮

### 加密过程

![](https://cdn.jsdelivr.net/gh/Miss3504186601/blog-assets@latest/pictures/20250607174130910.png)

**字节代换**
字节代替变换是可逆的,它由两个可逆变换复合而成.

AES中唯一的非线性变换：混淆作用

S盒变换是AES的唯一的非线性变换，是AES安全的关键。
![](https://cdn.jsdelivr.net/gh/Miss3504186601/blog-assets@latest/pictures/20250607174440746.png)


**行移位**
> 第0行不移位保持不变
> 第1行循环左移1个字节
> 第2行循环左移2个字节
> 第3行循环左移3个字节

线性变换：扩散作用

**列混淆**

线性变换：扩散作用

**轮密钥生成**

**AES的输入输出和中间状态**
- AES的分组长度为*128*比特。对于128比特的输入，经AES加密或解密处理后，得到的输出也为128比特。 
- 在AES中,各种运算是以字节为单位来进行处理的。
- AES 加密和解密过程中的中间各步的结果称为一个状态，每个状态也是128比特。

## 分组密码的工作模式

分组密码的工作模式是指以这个分组密码为基础通过某种方式构造一个分组密码系统，以解决对任意长度明文的加密问题。

> 分组密码的安全性依赖于**算法**，不依赖模式,工作模式不会损害算法的安全性。

1. 电子密码本模式（ECB）
    - 优点：简单有效,可以实现并行操作.一个密文块的改变,在解密时只会引起相应的明文块的改变,不会引起其他明文块的改变。
    - 缺点：相同的明文块对应相同的密文块，会暴露明文的统计规律
2. 密码分组链接模式CBC
    - 密文块$y_i$的改变,在解密时只会引起相应的明文块$x_i$和$x_{i+1}$的改变,而一个明文块的改变,在加密时将会引起相应的密文块以及其后的所有密文块的改变
    - 相同的明文块对应不同的密文块
3. 密码反馈模式（CFB）
4. 输出反馈模式OFB
5. 计数器模式CTR
### DES

- 电子密码本模式ECB
- 密码分组链接模式CBC
- 密码反馈模式CFB
- 输出反馈模式OFB

### AES

- 电子密码本模式ECB
- 密码分组链接模式CBC
- 密码反馈模式CFB
- 输出反馈模式OFB
- 计数器模式CTR

## 练习

1. 现代分组密码的设计基础是{扩散}和{混淆}。
2. 常见的分组密码的结构包括{Feistel网络}和{SP网络}。
3. 在DES密码体制中，{S盒}是非线性变换。
4. 在DES密码体制中，位选择函数E的输入是{32}bit，输出是{48}bit。
5. DES的8个S盒的输入共为{48}bit，输出共为{32}bit。
6. 若DES的S盒输入为001101，则其输出的数值位于S盒的第{1}行，第{6}列。
7. DES 算法的最后一圈不再进行交换，其主要目的是（B）
 A. 对称 B. 解密方便 C. 简单
8. DES 的密钥生成算法中，被分成的左右两部分各为（C）
 (A)16 比特 (B)24 比特 (C)28比特 (D)32比特

# 公钥密码

**对称密钥密码体制存在的问题**
- 密钥分配与管理问题
- 签名验证问题

**公钥密码体制的原理**

公钥密码体制也称 **_非对称密码体制_** ,公钥密码算法是基于数学函数（如 **_单向陷门函数_** ）而不是基于代替和置换

公钥密码算法要求每个参与方拥有一对相关的密钥K=(PK, SK) 
- 一个公开，称为公开密钥PK ，用于加密；另一个保密，称为私有密钥SK ，用于解密
- 在计算上由PK推出SK是困难的.

加密和解密会使用两把不同的密钥，因此称为非对称密码体制。

**单向函数与陷门单向函数**

在公钥密码中，加密变换是一个陷门单向函数，知道陷门的人可以容易地进行解密变换，而不知道陷门的人则无法有效地进行解密变换.

---

## 数学基础

### 中国剩余定理

$$
x\ \equiv\ a_i\ (mod\ m_i)
$$

$$
x\ \equiv\ \sum_{i=1}^{n}a_iM_iy_i\ (mod\ M_i)\ M\ = \prod_{i=1}^{n}m_i,\ M_i\ = M / m_i,\ y_i\ =\ M_i^{-1}\ (mod\ m_i)
$$

### Euler函数

1. **积性函数**：如果 $\gcd(m, n) = 1$，则 $\phi(mn) = \phi(m)\phi(n)$。
2. **素数幂**：对于素数 $p$ 和正整数 $k$，
   $$
   \phi(p^k) = p^k - p^{k-1} = p^k \left(1 - \frac{1}{p}\right)
   $$
3. **一般公式**：如果 \(n\) 的质因数分解为 \(n = p_1^{k_1} p_2^{k_2} \cdots p_m^{k_m}\)，则
   $$
   \phi(n) = n \prod_{i=1}^m \left(1 - \frac{1}{p_i}\right)
   $$

### Euler定理与Fermat定理

如果$\gcd(a, n) = 1$则：

$$
a^{\phi(n)} \equiv 1 \pmod{n}
$$

如果 \(p\) 是素数，且 \(\gcd(a, p) = 1\)，则：

$$
a^{p-1} \equiv 1 \pmod{p}
$$

### 模n求逆

- 求两个整数的最大公因子---欧几里得算法
- 模n求逆元---扩展的欧几里得算法

### 模n的大数幂乘的快速算法

![](https://cdn.jsdelivr.net/gh/Miss3504186601/blog-assets@latest/pictures/20250607181408340.png)

![](https://cdn.jsdelivr.net/gh/Miss3504186601/blog-assets@latest/pictures/20250607181439429.png)

### 大素数的生成

正确的生成大素数的方法是对生成的随机数先测试它是否为素数，而不是对它进行因子分解。素性测试算法:

- Miller-Rabin 素性测试法
- 

---

## RSA

### 加密过程

**密钥产生**:key:
- 选择两个大素数$p,q$不公开
- 计算$n=pq，\phi(n)=(p-1)(q-1)$，n公开，$\phi(n)$不公开
- 计算$e$，$1<e<\phi(n)$， $gcd(e，\phi(n))=1$，$e$公开
- 计算$d$，$ed\equiv 1\pmod{\phi(n)}$，$d$不公开

**加密**:lock:
$$
c=m^e\pmod{n}
$$

**解密**:unlock:
$$
m=c^d\pmod{n}
$$

### 安全性

>「大整数的素分解问题」的「难解性」:寻求两个大素数的乘积比较简单，而将它们的乘积分解开(因式分解)则极其困难。

为了确保RSA密码的安全，参数建议满足以下条件：
- n 的长度为 1024 比特至 2048 比特
- p和q的长度应该相差不多
- p-1和q-1 都应该包含大的素因子
- gcd(p-1,q-1)应该很小

## EIGamal

ElGamal 公钥密码体制是由 T. ElGamal于1985年提出的。

### 安全性

「有限域」上「离散对数问题」的「难解性」

**有限域上的离散对数问题**

_本原元_

**为了抵抗目前已知的一些对 EIGamal 公钥密码体制的攻击**
- 素数p按十进制表示至少应该有 150 位数字
- p-1 至少应该有一个大的素因子

### 加密过程

- 选择大素数$p$，$\alpha$为$Z_p$的本原元，均公开
- 选择$d$, $1<d<p-2$，$d$不公开; $\beta=\alpha^d\pmod{p}$,加密密钥，公开
- 选择$k$，$1<k<p-2$，$k$不公开
  - 加密：$c=(c_1,\ c_2)$
  - $c_1=\alpha^k\pmod{p}$
  - $c_2=m\beta^k\pmod{p}$
- 解密：$m=c_2(c_1^d)^{-1}mod{p}$

### 有限域上离散对数的计算方法

Shanks算法

![](https://cdn.jsdelivr.net/gh/Miss3504186601/blog-assets@latest/pictures/20250607182028754.png)

## Menezes-Vanstone公钥密码

### 椭圆曲线加法公式

#### 椭圆曲线定义

在仿射坐标系下，椭圆曲线的方程为：

$$
E: y^2 = x^3 + a x + b \quad ( 4a^3 + 27b^2 \neq 0)
$$

#### 加法规则

设 $P = (x_1, y_1)$ 和 $Q = (x_2, y_2)$ 是椭圆曲线上的点，计算 $P + Q = R = (x_3, y_3)$ 的规则如下：

$$
P + Q = 
\begin{cases}
\mathcal{O} & \text{如果 } P = -Q \text{（即 } x_1 = x_2 \text{ 且 } y_1 = -y_2\text{）}, \\
2P & \text{如果 } P = Q \text{（倍点运算）}, \\
\text{一般加法} & \text{否则}.
\end{cases}
$$

##### (1) \(P = -Q\)（结果为无穷远点）

$$
P + Q = \mathcal{O}
$$

##### (2) \(P = Q\)（倍点运算）

$$
m = \frac{3x_1^2 + a}{2y_1} \pmod{p}, \\
x_3 = m^2 - 2x_1 \pmod{p}, \\
y_3 = m(x_1 - x_3) - y_1 \pmod{p}.
$$

##### (3) 一般情况（$P \neq Q$ 且 $P \neq -Q$）

$$
m = \frac{y_2 - y_1}{x_2 - x_1} \pmod{p}, \\
x_3 = m^2 - x_1 - x_2 \pmod{p}, \\
y_3 = m(x_1 - x_3) - y_1 \pmod{p}.
$$

#### 3. 无穷远点 $\mathcal{O}$ 的性质

- 单位元：
  $$
  P + \mathcal{O} = \mathcal{O} + P = P
  $$
- 逆元：
  $$
  -P = (x_1, -y_1), \quad P + (-P) = \mathcal{O}
  $$

### 安全性

「椭圆曲线上」的「离散对数问题」的「难解性」

已知n和P，求Q，是容易的；已知P和Q，求n是难解的。

密文依赖于明文x和秘密选取的随机整数 k；因此,明文空间中的一个明文对应密文空间中的许多不同的密文。

普遍认为，椭圆曲线密码比RSA和ElGamal密码更安全。 160位的椭圆曲线密码的安全性相当于1024位的RSA密码，而且运算速度也较快。